---
name: rpi-essential-base
mmdebstrap:
  packages:
    - ca-certificates
    - curl
    - wget
    - iproute2
    - iputils-ping
    - sudo
    - micro
    - less
    - bash-completion
    - openssh-client
    - procps
    - udev
    - zstd
  customize-hooks:
    - |-
      # Run all actions inside the target rootfs
      chroot "$1" /bin/sh -eu -c '
        update-alternatives --install /usr/bin/editor editor /usr/bin/micro 50
        update-alternatives --set editor /usr/bin/micro
        install -d -m 0755 /etc/profile.d
        printf %s\n "        export EDITOR=/usr/bin/micro" "        export VISUAL=/usr/bin/micro" > /etc/profile.d/99-editor.sh

        install -d -m 0755 /etc/skel/.config/micro
        printf %s\n "        {" "          \"softwrap\": true," "          \"tabsize\": 2," "          \"autosu\": true" "        }" > /etc/skel/.config/micro/settings.json
      '
