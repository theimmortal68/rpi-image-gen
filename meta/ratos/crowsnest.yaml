# ratos-crowsnest.yaml (removed pkglist sourcing/apt; assumes ffmpeg, libcamera/v4l2 stack preinstalled)
name: ratos-crowsnest
mmdebstrap:
  variant: apt
  packages: []
  customize-hooks:
    - |-
      chroot "$1" /bin/sh -eu -c '
        U="$KSconf_device_user1"
        H="/home/$KSconf_device_user1"

        # Clone crowsnest into user's home
        runuser -u "$U" -- git clone --depth 1 https://github.com/mainsail-crew/crowsnest.git "$H/crowsnest"

        # Unattended install + Moonraker integration (system deps already present)
        export CROWSNEST_UNATTENDED=1
        export CROWSNEST_ADD_CROWSNEST_MOONRAKER=1
        make -C "$H/crowsnest" install
      '
    - '"$KS_HELPERS/enable-units" "$1" crowsnest'
