---
name: ratos-prerequisite
mmdebstrap:
  variant: apt
  packages:
    - python3-numpy
    - python3-matplotlib
    - python3-opencv
    - python3-serial
    - python3-pip 
    - python3-venv
    - virtualenv
    - python3-dev
    - libffi-dev
    - build-essential
    - libatlas3-base
    - libatlas-base-dev
    - libgfortran5
    - libopenblas-dev
    - git
    - pkg-config
    - uuid
  customize-hooks:
    - |-
      chroot "$1" /bin/sh -eu -c '
        # Add piwheels to pip.conf if not already present
        if [ ! -f /etc/pip.conf ]; then
          echo "Adding piwheels to pip.conf"
          printf "%s\n" "[global]" > /etc/pip.conf
          printf "%s\n" "extra-index-url=https://www.piwheels.org/simple" >> /etc/pip.conf
          chmod 0644 /etc/pip.conf
        fi

        # Install pnpm globally using npm
        npm install -g pnpm
      '
    - runuser -u ${IGconf_device_user1} -- curl -fsSL https://deb.nodesource.com/setup_22.x | bash -
    - apt-get install -y nodejs
